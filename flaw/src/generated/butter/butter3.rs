//! Butterworth filter of order 3.
//! Region of validity: cutoff ratio from 5.62e-03 to 4.00e-01 .
//! This file is autogenerated.
#![allow(clippy::style)]

use crate::SisoIirFilter;

/// Minimum tabulated cutoff ratio
#[allow(dead_code)]
pub const MIN_CUTOFF_RATIO: f64 = 0.005623413251903491;

/// Maximum tabulated cutoff ratio
#[allow(dead_code)]
pub const MAX_CUTOFF_RATIO: f64 = 0.4;

/// Initialise a Butterworth filter of order 3 by interpolating the coefficients from stored tables.
/// Cutoff ratio is the dimensionless ratio of the cutoff frequency to the sampling frequency.
/// Region of validity: cutoff ratio from 5.62e-03 to 4.00e-01
pub fn butter3(cutoff_ratio: f64) -> Result<SisoIirFilter<3>, &'static str> {
    let avals = &[&AVALS[0][..], &AVALS[1][..], &AVALS[2][..]];
    let cvals = &[&CVALS[0][..], &CVALS[1][..], &CVALS[2][..]];
    SisoIirFilter::new_interpolated(cutoff_ratio, &LOG10_CUTOFF_RATIOS, avals, cvals, &DVALS)
}

/// [dimensionless] Log base-10 of cutoff ratios, to improve float precision during interpolation
#[rustfmt::skip]
const LOG10_CUTOFF_RATIOS: [f64; 100] = [-2.25, -2.2312923233199196, -2.212584646639839, -2.1938769699597587, -2.1751692932796782, -2.156461616599598, -2.1377539399195173, -2.119046263239437, -2.1003385865593565, -2.081630909879276, -2.0629232331991956, -2.044215556519115, -2.0255078798390347, -2.0068002031589542, -1.988092526478874, -1.9693848497987936, -1.9506771731187131, -1.9319694964386327, -1.9132618197585523, -1.8945541430784718, -1.8758464663983914, -1.857138789718311, -1.8384311130382307, -1.8197234363581503, -1.8010157596780698, -1.7823080829979894, -1.763600406317909, -1.7448927296378285, -1.726185052957748, -1.7074773762776676, -1.6887696995975872, -1.6700620229175067, -1.6513543462374263, -1.6326466695573458, -1.6139389928772654, -1.595231316197185, -1.5765236395171045, -1.557815962837024, -1.5391082861569436, -1.5204006094768632, -1.5016929327967827, -1.4829852561167023, -1.4642775794366218, -1.4455699027565414, -1.4268622260764612, -1.4081545493963807, -1.3894468727163003, -1.3707391960362199, -1.3520315193561394, -1.333323842676059, -1.3146161659959785, -1.295908489315898, -1.2772008126358176, -1.2584931359557374, -1.2397854592756568, -1.2210777825955763, -1.202370105915496, -1.1836624292354156, -1.1649547525553352, -1.1462470758752548, -1.1275393991951743, -1.1088317225150939, -1.0901240458350134, -1.071416369154933, -1.0527086924748525, -1.034001015794772, -1.0152933391146917, -0.9965856624346112, -0.9778779857545308, -0.9591703090744503, -0.9404626323943699, -0.9217549557142894, -0.903047279034209, -0.8843396023541288, -0.8656319256740483, -0.8469242489939679, -0.8282165723138875, -0.809508895633807, -0.7908012189537266, -0.7720935422736461, -0.7533858655935657, -0.7346781889134852, -0.7159705122334048, -0.6972628355533244, -0.6785551588732439, -0.6598474821931635, -0.641139805513083, -0.6224321288330026, -0.6037244521529224, -0.5850167754728419, -0.5663090987927615, -0.547601422112681, -0.5288937454326006, -0.5101860687525201, -0.4914783920724397, -0.47277071539235926, -0.4540630387122788, -0.4353553620321984, -0.4166476853521179, -0.3979400086720376];

/// State-Space `D` 1x1 matrix
#[rustfmt::skip]
const DVALS: [f64; 100] = [5.324017453638435e-06, 6.049216763289956e-06, 6.8727441171800116e-06, 7.807847852769414e-06, 8.869545937269366e-06, 1.007485952503524e-05, 1.1443076827150309e-05, 1.299605113454519e-05, 1.475853730616782e-05, 1.675857155847687e-05, 1.9027899977695262e-05, 2.1602461828172324e-05, 2.452293445576861e-05, 2.7835347391886752e-05, 3.1591774159739043e-05, 3.5851111278420505e-05, 4.06799550617649e-05, 4.615358802790555e-05, 5.2357088082729235e-05, 5.938657512749265e-05, 6.735061137993549e-05, 7.63717735021048e-05, 8.658841661028387e-05, 9.815665241693448e-05, 0.00011125256613600593, 0.00012607469938633837, 0.00014284682916853672, 0.00016182107608417242, 0.0001832813783280813, 0.00020754737163038322, 0.00023497871926984437, 0.0002659799405390556, 0.0003010057906286208, 0.00034056724982518474, 0.00038523818519871323, 0.00043566275359856497, 0.0004925636207949201, 0.0005567510779998516, 0.0006291331437872522, 0.0007107267466083811, 0.0008026700906747357, 0.0009062363159573365, 0.0010228485714376089, 0.0011540966295493066, 0.001301755178988091, 0.0014678039427585918, 0.001654449778513845, 0.0018641509289722149, 0.002099643601550243, 0.0023639710684367505, 0.0026605154913078486, 0.002993032688953839, 0.003365690081539029, 0.003783108062415965, 0.004250405067852996, 0.004773246637335436, 0.005357898783068456, 0.0060112860179599445, 0.0067410544279728245, 0.007555640218903702, 0.008464344221349522, 0.009477412903312868, 0.010606126520577658, 0.011862895134347871, 0.013261363348189628, 0.014816524767551338, 0.016544847371764777, 0.0184644112186308, 0.020595060185448835, 0.0229585697998739, 0.02557883364425161, 0.028482071346530552, 0.03169706182227669, 0.03525540623404606, 0.039191826121810394, 0.04354450337578685, 0.048355470227211865, 0.05367105929502899, 0.059542426039060424, 0.06602615885159777, 0.07318499562349966, 0.08108867014910756, 0.08981491745130148, 0.09945067436411073, 0.11009352097183825, 0.12185342039533384, 0.13485482977969815, 0.14923927531465558, 0.16516851026604018, 0.18282840945126516, 0.20243379930474575, 0.2242344837532859, 0.24852280829509926, 0.2756432160310818, 0.30600440139521207, 0.3400948763572848, 0.3785030535688726, 0.4219433558356573, 0.4712904328095424, 0.5276243825019431];

/// State-Space `A` matrix, first row
#[rustfmt::skip]
const AVALS: [[f64; 100]; 3] = [[2.9293377766316904, 2.926227763971357, 2.9229809045283295, 2.919591181207929, 2.91605231295515, 2.912357743258352, 2.9085006281635852, 2.9044738237802346, 2.9002698732581402, 2.895880993215787, 2.8912990595986714, 2.886515592946428, 2.8815217430468403, 2.8763082729544505, 2.870865542351091, 2.865183490225345, 2.859251616847695, 2.8530589650179476, 2.8465941005614357, 2.8398450920505374, 2.8327994897282127, 2.8254443036105252, 2.817765980745593, 2.809750381607038, 2.8013827556008244, 2.7926477156654377, 2.783529211946647, 2.774010504529656, 2.764074135213301, 2.7537018983131105, 2.742874810482546, 2.731573079544573, 2.7197760723289344, 2.7074622815140477, 2.6946092914764352, 2.68119374315485, 2.667191297940949, 2.6525766006132856, 2.637323241336548, 2.6214037167533406, 2.6047893902011072, 2.5874504510920415, 2.5693558734987456, 2.550473373992649, 2.5307693687856645, 2.5102089302275927, 2.4887557427121356, 2.4663720580422512, 2.443018650300486, 2.418654770260804, 2.3932380993645133, 2.366724703262878, 2.3390689849016497, 2.3102236370864824, 2.280139594421324, 2.248765984452299, 2.216050077775192, 2.18193723677285, 2.146370862536853, 2.1092923393925433, 2.070640976284676, 2.030353944088785, 1.9883662076868918, 1.944610451381179, 1.8990169959111212, 1.8515137049834154, 1.8020258788148782, 1.7504761317207551, 1.69678425024916, 1.6408670277606436, 1.5826380706742984, 1.522007570842032, 1.4588820376646026, 1.3931639826204052, 1.3247515478351766, 1.2535380691726719, 1.1794115630695048, 1.1022541249712423, 1.0219412257556495, 0.9383408909652746, 0.8513127460411103, 0.7607069090992511, 0.6663627112046959, 0.5681072227056339, 0.46575356321578076, 0.359098972618506, 0.24792262155943773, 0.13198314314281873, 0.011015874264518624, -0.11527019277638344, -0.2471957269447261, -0.3851145878459993, -0.5294174575981192, -0.6805353789589024, -0.8389428698302337, -1.0051600791200945, -1.179753138115089, -1.3633313984587028, -1.5565395754196594, -1.7600418803431688], [-2.8611500928032227, -2.855151626187598, -2.8488992500425674, -2.84238268932031, -2.835591296418754, -2.828514041762043, -2.8211395045668124, -2.8134558638525893, -2.805450889761099, -2.7971119352563543, -2.788425928285102, -2.7793793644855036, -2.76995830054092, -2.7601483482854277, -2.7499346696781606, -2.7393019727748973, -2.7282345088374518, -2.716716070734509, -2.7047299928015134, -2.6922591523422152, -2.6792859729704706, -2.665792430007915, -2.6517600581712815, -2.6371699618023396, -2.6220028279138123, -2.6062389423460774, -2.589858209352103, -2.5728401749517746, -2.555164054421603, -2.53680876431163, -2.517752959408239, -2.497975075089248, -2.477453375546247, -2.4561660083782866, -2.4340910660907324, -2.411206655063088, -2.3874909725796774, -2.3629223925470373, -2.337479560551342, -2.31114149893799, -2.2838877226231573, -2.255698366373394, -2.2265543243138946, -2.19643740244835, -2.1653304849932824, -2.1332177153467944, -2.1000846925258543, -2.0659186839171615, -2.03070885519458, -1.9944465182610989, -1.9571253980759198, -1.918741919228387, -1.8792955131213376, -1.838788946629003, -1.7972286731013838, -1.7546252066014847, -1.7109935202884987, -1.6663534699048383, -1.6207302433951207, -1.5741548377901182, -1.526664564639909, -1.4783035854919424, -1.4291234791990124, -1.379183843230131, -1.3285529316696696, -1.2773083332575679, -1.2255376936832594, -1.1733394874427576, -1.1208238459561692, -1.0681134503866376, -1.0153444997800523, -0.9626677678531056, -0.910249765111803, -0.8582740271256363, -0.8069425548900133, -0.7564774394988727, -0.707122711092466, -0.6591464615836794, -0.6128433024317492, -0.5685372332741048, -0.5265850152479157, -0.4873801652355671, -0.4513577152179723, -0.4189999159250437, -0.3908431079919008, -0.3674860394072092, -0.34959997848255553, -0.33794106116613326, -0.3333654258032219, -0.3368478344910153, -0.3495046669185184, -0.3726224110208559, -0.40769307789157305, -0.45645835032998183, -0.5209647479949655, -0.6036326629798572, -0.7073427729318298, -0.8355440118698036, -0.9923878044220258, -1.1828932620378305], [0.9317697240319034, 0.9288754684821338, 0.9258633635613006, 0.9227290453295584, 0.9194680270961061, 0.9160756996274907, 0.91254733178861, 0.908878071663278, 0.9050629482045095, 0.9010968734680996, 0.8969746454866092, 0.8926909518444502, 0.8882403740184338, 0.883617392551842, 0.8788163931337917, 0.873831673659325, 0.8686574523492626, 0.8632878770123378, 0.8577170355354159, 0.8519389676906581, 0.8459476783512183, 0.8397371522093734, 0.8333013700928061, 0.8266343269759662, 0.8197300517838997, 0.812582629085549, 0.8051862227721077, 0.7975351018134456, 0.7896236681816772, 0.7814464870254761, 0.7729983191715343, 0.7642741560203622, 0.755269256892284, 0.7459791888656374, 0.7363998691327075, 0.7265276098794498, 0.7163591656723685, 0.705891783309753, 0.695123254064496, 0.6840519682117825, 0.6726769716966522, 0.6609980247536938, 0.649015662243648, 0.6367312554193069, 0.6241470747757137, 0.6112663535771331, 0.5980933515856085, 0.5846334184431327, 0.5708930560816922, 0.5568799794528008, 0.5426031747809437, 0.5280729544538777, 0.5133010075673755, 0.49830044504319304, 0.48308583813723605, 0.467673249050502, 0.452080252248759, 0.43632594498830923, 0.42043094543448506, 0.40441737664634564, 0.388308834584437, 0.37213033817665464, 0.3559082593474995, 0.3396702307741692, 0.3234450289730315, 0.30726243013374166, 0.2911530358942631, 0.27514806597295605, 0.25927911422341865, 0.2435778642270029, 0.22807575995174112, 0.21280362623882926, 0.19779123286898698, 0.18306679463286257, 0.16865639808035343, 0.1545833433199062, 0.14086738620526626, 0.12752386225220513, 0.11456266836361623, 0.10198707149604813, 0.08979230421880799, 0.07796389494345543, 0.06647566440286497, 0.05528729830652405, 0.04434137700141413, 0.033559703626032604, 0.022838718685532475, 0.012043715506069915, 0.0010014694103816953, -0.010509248342722969, -0.02277000057472174, -0.03613887115943189, -0.05107193087110219, -0.06815199895976924, -0.0881275933364977, -0.11196626875832721, -0.1409285175040626, -0.1766714363567519, -0.22139608263465393, -0.2780599176345464]];

/// State-Space `C` vector
#[rustfmt::skip]
const CVALS: [[f64; 100]; 3] = [[3.156789781130483e-05, 3.5849036332889885e-05, 4.070713216776662e-05, 4.621926729346709e-05, 5.2472697757044386e-05, 5.956617372508226e-05, 6.761142662134177e-05, 7.67348437364315e-05, 8.707935304093833e-05, 9.880654352507044e-05, 0.00011209904924473367, 0.0001271632283975664, 0.0001442321722049156, 0.0001635690821595052, 0.00018547105833614954, 0.00021027334597642361, 0.00023835409246893754, 0.0002701396721744776, 0.0003061106423070602, 0.0003468083992919785, 0.00039284261168977085, 0.00044489951290446967, 0.0005037511444819362, 0.0005702656488365545, 0.000645418718697765, 0.0007303063194034797, 0.0008261588093301845, 0.0009343565931643043, 0.001056447452287137, 0.0011941657061396325, 0.001349453367894239, 0.0015244834668925174, 0.0017216857188700383, 0.0019437747326962135, 0.0021937809488641125, 0.0024750845098697807, 0.002791452265451257, 0.0031470781158681833, 0.003546626893367005, 0.003995281974980364, 0.00449879680804552, 0.0050635505123918095, 0.005696607699035848, 0.006405782613328085, 0.007199707669605434, 0.008087906393211663, 0.009080870722846688, 0.01019014255010722, 0.011428399282222055, 0.012809543106743329, 0.014348793511670985, 0.01606278246948189, 0.017969651527136137, 0.020089149854693702, 0.02244273209109966, 0.025053654585447557, 0.027947068364135828, 0.031150106857358625, 0.03469196609089438, 0.038603974689650884, 0.0429196506461533, 0.047674741377937827, 0.05290724312970134, 0.05865739526493542, 0.0649676444317338, 0.07188257297000153, 0.07944878524025678, 0.08771474478038256, 0.09673055431194963, 0.10654766958877607, 0.11721853686159203, 0.12879614226227407, 0.14133345960609398, 0.15488278086006207, 0.1694949106827866, 0.18521820281212728, 0.20209741140527243, 0.2201723243846088, 0.23947613796800377, 0.2600335212786163, 0.2818583064637471, 0.304950722079419, 0.32929406425337965, 0.35485066950152955, 0.3815570125951197, 0.40931769926001677, 0.43799805226802896, 0.46741489458035146, 0.4973250063396691, 0.5274105623513486, 0.5572606277369178, 0.5863474804683505, 0.6139961115625616, 0.6393446876140825, 0.6612929934984542, 0.6784348362442272, 0.6889689954725966, 0.6905814421251871, 0.6802890882439145, 0.6542321372122061], [7.392393293517206e-07, 8.762192110012694e-07, 1.0384767903714318e-06, 1.2306519807497095e-06, 1.458230548900763e-06, 1.7276969397634778e-06, 2.0467143905841378e-06, 2.424337132221312e-06, 2.8712603013425806e-06, 3.4001141513672744e-06, 4.025810274464803e-06, 4.765948857209038e-06, 5.641297517928638e-06, 6.676354047992951e-06, 7.9000074407081e-06, 9.346313984111865e-06, 1.1055407967830926e-05, 1.3074569766245811e-05, 1.5459477775079267e-05, 1.8275674969227317e-05, 2.1600285798559958e-05, 2.5524024838124336e-05, 3.0153545163406084e-05, 3.5614181945790846e-05, 4.205315538674184e-05, 4.964330697376497e-05, 5.8587454303557854e-05, 6.912346254923067e-05, 8.153014523548392e-05, 9.613412352935048e-05, 0.00011331779196992469, 0.00013352855967688562, 0.0001572895598340189, 0.00018521204688805944, 0.0002180097306869449, 0.00025651532995572476, 0.00030169966431572905, 0.0003546936447190031, 0.0004168135668936462, 0.0004895901613333282, 0.000574801906615362, 0.0006745131704188026, 0.0007911178044601292, 0.0009273888854662449, 0.001086535363903473, 0.0012722664549272753, 0.0014888646811318192, 0.001741268553111412, 0.0020351659502300095, 0.0023770993385966045, 0.002774584033910521, 0.003236240780944929, 0.0037719439758238, 0.004392986898174354, 0.005112265343318151, 0.005944481044811777, 0.006906366249013607, 0.008016930739261843, 0.009297732500130322, 0.010773173053522255, 0.01247081827839967, 0.014421745233783593, 0.016660915127820114, 0.019227572099817694, 0.02216566689039485, 0.02552430374714354, 0.029358208024960194, 0.03372821086069183, 0.03870174599159297, 0.044353352194735934, 0.05076517288127501, 0.05802744199259419, 0.06623894238836842, 0.0755074192156932, 0.08594992606389235, 0.09769307570939528, 0.11087315947841851, 0.12563608906132076, 0.1421371011086053, 0.16054014687758936, 0.18101686483417975, 0.20374500099131826, 0.2289060964205942, 0.2566821988950809, 0.28725126900911, 0.32078083033669863, 0.3574192437498433, 0.39728374687646734, 0.4404440600439982, 0.4868998745467002, 0.5365498403151818, 0.5891486572896913, 0.6442473962452114, 0.7011100004240469, 0.7585956983274292, 0.8149922531905013, 0.8677777612320464, 0.9132778231902385, 0.9461684205676593, 0.9587498205574098], [1.0284775727156157e-05, 1.1668185818240891e-05, 1.3235966102408438e-05, 1.5012375848033778e-05, 1.7024809841448714e-05, 1.9304193513080584e-05, 2.18854260532184e-05, 2.4807877028947982e-05, 2.8115942591674307e-05, 3.1859667993611794e-05, 3.6095443814543126e-05, 4.088678403974688e-05, 4.630519492879005e-05, 5.243114447508044e-05, 5.9355143179498236e-05, 6.71789478493894e-05, 7.601690118740008e-05, 8.599742105301819e-05, 9.72646544623144e-05, 0.00010998031263629245, 0.00012432570471232707, 0.0001405039890919416, 0.00015874266280580012, 0.00017929631072582095, 0.0002024496379357658, 0.00022852081007485945, 0.00025786512798172333, 0.0002908790644745242, 0.0003280046925928946, 0.00036973453608231714, 0.0004166168743065139, 0.00046926153511288847, 0.0005283462104369737, 0.000594623330603977, 0.0006689275343639674, 0.0007521837726840301, 0.00084541608522813, 0.0009497570893087942, 0.0010664582219364735, 0.001196900776486601, 0.0013426077765412942, 0.0015052567307652005, 0.001686693314404158, 0.0018889460253574274, 0.0021142418660276435, 0.002365023106614775, 0.002643965191575258, 0.0029539958590711823, 0.003298315553921632, 0.0036804192284548235, 0.00410411964344537, 0.004573572303786726, 0.005093302191552535, 0.005668232493564332, 0.006303715562479517, 0.007005566400737483, 0.0077800990164413625, 0.008634166070341329, 0.00957520231435076, 0.010611272415116358, 0.01175112386146327, 0.013004245772062476, 0.014380934548935803, 0.015892367462281582, 0.017550685400566722, 0.019369086173765933, 0.02136192991246131, 0.023544858254766418, 0.025934929147710006, 0.028550769197433754, 0.03141274556634346, 0.03454315941186531, 0.0379664627584293, 0.041709500446792315, 0.045801778349706446, 0.05027575829082093, 0.05516717892684577, 0.0605154000674982, 0.06636376524693845, 0.0727599734350051, 0.07975644501477706, 0.08741065870971709, 0.09578542376216521, 0.1049490334644643, 0.11497521929066362, 0.1259427850696196, 0.13793474130042205, 0.15103667068887733, 0.16533392147662992, 0.18090702029223676, 0.1978243815782336, 0.21613090263542417, 0.23583026860995976, 0.25685757985886404, 0.2790369699498764, 0.30201572202773497, 0.3251611793586506, 0.34739801709898366, 0.36694857720231916, 0.3809131901614744]];

#[cfg(feature = "std")]
#[cfg(test)]
#[rustfmt::skip]
mod test {
    use super::*;
    const CUTOFF_TEST_INPUT: [f32; 101] = [0.0, 0.5877852522924732, -0.9510565162951536, 0.9510565162951535, -0.5877852522924728, -4.898587196589413e-16, 0.5877852522924737, -0.9510565162951538, 0.9510565162951533, -0.5877852522924724, -9.797174393178826e-16, 0.587785252292474, -0.951056516295154, 0.9510565162951532, -0.587785252292472, -1.4695761589768238e-15, 0.5877852522924744, -0.9510565162951541, 0.951056516295153, -0.5877852522924716, -1.959434878635765e-15, 0.5877852522924748, -0.9510565162951542, 0.9510565162951529, -0.5877852522924712, -2.4492935982947065e-15, 0.5877852522924751, -0.9510565162951544, 0.9510565162951528, -0.5877852522924709, -2.9391523179536475e-15, 0.5877852522924756, -0.9510565162951545, 0.9510565162951525, -0.5877852522924705, -3.429011037612589e-15, 0.587785252292476, -0.9510565162951546, 0.9510565162951524, -0.58778525229247, -3.91886975727153e-15, 0.5877852522924764, -0.9510565162951549, 0.9510565162951523, -0.5877852522924696, -4.408728476930472e-15, 0.5877852522924768, -0.951056516295155, 0.9510565162951521, -0.5877852522924693, -4.898587196589413e-15, 0.5877852522924887, -0.9510565162951552, 0.9510565162951563, -0.5877852522924689, -1.9599300631450357e-14, 0.5877852522924776, -0.9510565162951509, 0.9510565162951518, -0.5877852522924569, -5.878304635907295e-15, 0.5877852522924665, -0.9510565162951554, 0.9510565162951473, -0.587785252292468, 7.842691359635767e-15, 0.5877852522924784, -0.95105651629516, 0.9510565162951515, -0.5877852522924791, -6.858022075225178e-15, 0.5877852522924902, -0.9510565162951558, 0.9510565162951558, -0.5877852522924673, -2.1558735510086122e-14, 0.5877852522924791, -0.9510565162951515, 0.9510565162951512, -0.5877852522924554, -7.83773951454306e-15, 0.587785252292468, -0.9510565162951561, 0.9510565162951466, -0.5877852522924665, 5.883256481000002e-15, 0.5877852522924799, -0.9510565162951606, 0.9510565162951509, -0.5877852522924776, -8.817456953860943e-15, 0.5877852522924919, -0.9510565162951563, 0.9510565162951552, -0.5877852522924657, -2.3518170388721888e-14, 0.5877852522924807, -0.9510565162951521, 0.9510565162951506, -0.5877852522924538, -9.797174393178826e-15];
    const CUTOFF_TEST_OUTPUT: [f32; 101] = [0.0, 0.310129830784565, -0.11725260530555914, -0.2336927131905271, 0.4637716039147073, -0.4340089382940309, 0.16180312459268498, 0.2181087335673777, -0.5278075636855191, 0.6259731020226973, -0.46483443936752733, 0.10597178936395224, 0.3077357641200972, -0.610941044526917, 0.6817967559001235, -0.4896700585018545, 0.10676618396611354, 0.3201931622840901, -0.6269004808270586, 0.6949293705266848, -0.49736960368507066, 0.10922090413658253, 0.321328838356139, -0.6296620553267336, 0.6977639144398999, -0.4994076578107751, 0.11022288503425515, 0.3211879374588541, -0.630032599136754, 0.6983041470601731, -0.49988099717952605, 0.11051997800171198, 0.3210747343058298, -0.6300531694099611, 0.6983916492033991, -0.4999791949192441, 0.11059502420900819, 0.32103447644395033, -0.6300437806845725, 0.6984018780648557, -0.49999710990603735, 0.11061184505654675, 0.3210232183286109, -0.6300388817575463, 0.6984018956934168, -0.4999998054101902, 0.11061520620879317, 0.3210204861517958, -0.6300372993846097, 0.6984014079226059, -0.5000000589825587, 0.11061578949310652, 0.32101989512555307, -0.6300368786084212, 0.6984012042718772, -0.5000000339413575, 0.11061586931559925, 0.3210197816406204, -0.6300367802546508, 0.6984011432102495, -0.5000000112567158, 0.11061587427085806, 0.3210197630644467, -0.630036759729059, 0.6984011276800932, -0.5000000030373063, 0.11061587246753363, 0.3210197608340364, -0.6300367559557694, 0.6984011241787151, -0.5000000007179657, 0.11061587147792129, 0.3210197608058476, -0.6300367553804465, 0.6984011234746641, -0.5000000001514937, 0.1106158711537425, 0.32101976090207707, -0.6300367553238782, 0.698401123351415, -0.5000000000282208, 0.11061587106686915, 0.321019760943435, -0.6300367553282082, 0.698401123334242, -0.5000000000043938, 0.11061587104645965, 0.32101976095598095, -0.6300367553327504, 0.6984011233330718, -0.5000000000004714, 0.11061587104216886, 0.3210197609592105, -0.6300367553344276, 0.6984011233334237, -0.499999999999983, 0.11061587104135479, 0.32101976095993656, -0.6300367553349008, 0.6984011233336229, -0.49999999999995515];
    const STEP_TEST_MIN_OUTPUT: f32 = 1.000000000002421;
    const STEP_TEST_MAX_OUTPUT: f32 = 1.1818565197141493;

    #[test]
    fn test() {
        println!("order 3");
        let mut filter = butter3(0.4).unwrap();
        let out = (0..CUTOFF_TEST_INPUT.len()).map(|i| {filter.update(CUTOFF_TEST_INPUT[i])}).collect::<Vec<f32>>();
        // Check overall match to reference output to catch phase error, etc
        (0..CUTOFF_TEST_INPUT.len()).for_each(|i| { let expected = CUTOFF_TEST_OUTPUT[i]; let rel_err = (out[i] - expected).abs() / expected.abs().max(1e-4); assert!(rel_err < 0.05); });
        // Check approximate attenuation at cutoff frequency; should be -3dB or 1/sqrt(2) magnitude
        let maxmag = out.iter().fold(0.0_f32, |a, b| a.abs().max(b.abs()));
        let attenuation_rel_err = (maxmag - 0.707).abs() / 0.707;
        println!("attenuation rel err {attenuation_rel_err}");
        assert!(attenuation_rel_err < 0.05);
        // Check convergence of step responses at min and max tabulated cutoff
        let mut filtermin = butter3(MIN_CUTOFF_RATIO).unwrap();
        (0..1769).for_each(|_| {filtermin.update(1.0);});
        let step_min_final = filtermin.update(1.0);
        let step_min_rel_err = (step_min_final - STEP_TEST_MIN_OUTPUT).abs() / STEP_TEST_MIN_OUTPUT;
        println!("step min rel err {step_min_rel_err}");
        assert!(step_min_rel_err < 1e-3);
        let mut filtermax = butter3(MAX_CUTOFF_RATIO).unwrap();
        (0..1).for_each(|_| {filtermax.update(1.0);});
        let step_max_final = filtermax.update(1.0);
        let step_max_rel_err = (step_max_final - STEP_TEST_MAX_OUTPUT).abs() / STEP_TEST_MAX_OUTPUT;
        println!("step max rel err {step_max_rel_err}");
        assert!(step_max_rel_err < 1e-6);
    }
}
